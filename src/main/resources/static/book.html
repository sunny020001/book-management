<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>book</title>
  <link href="./css/layui.css" rel="stylesheet">
</head>
<body>
<form class="layui-form layui-row layui-col-space16">
  <div class="layui-col-md4">
    <div class="layui-input-wrap">
      <div class="layui-input-prefix">
        <i class="layui-icon layui-icon-username"></i>
      </div>
      <input type="text" name="id" value="" placeholder="æŒ‰IDæŸ¥è¯¢" class="layui-input" lay-affix="clear">
    </div>
  </div>
  <div class="layui-col-md4">
    <div class="layui-input-wrap">
      <input type="text" name="title" placeholder="æŒ‰ä¹¦åæŸ¥è¯¢" lay-affix="clear" class="layui-input">
    </div>
  </div>
  <div class="layui-btn-container layui-col-md4">
    <button class="layui-btn" lay-submit lay-filter="demo-table-search">æŸ¥è¯¢</button>
    <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>
  </div>
</form>
<table class="layui-hide" id="books_table"></table>

<script type="text/html" id="toolbarDemo">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="createNewBook">æ–°å»ºä¹¦ç±ä¿¡æ¯</button>
  </div>
</script>

<script type="text/html" id="barDemo">
  <div class="layui-clear-space">
    <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
    <a class="layui-btn layui-btn-xs" lay-event="more">
      æ›´å¤š 
      <i class="layui-icon layui-icon-down"></i>
    </a>
  </div>
</script>
  
<script src="./layui.js"></script>
<script>
layui.use(function(){
  var table = layui.table;
  var form = layui.form;
  var laydate = layui.laydate;
  var dropdown = layui.dropdown;
  var $ = layui.$;
  // åˆ›å»ºè¡¨æ ¼å®ä¾‹
  table.render({
    elem: '#books_table',
    url: '/books', 
    method: 'post',
    contentType: 'application/json',
    where: {id: '', title: ''},
    toolbar: '#toolbarDemo',
    parseData: function(res){ // res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
        return {
        "code": res.code == 200?0:res.code, // è§£ææ¥å£çŠ¶æ€
        "msg": res.message, // è§£ææç¤ºæ–‡æœ¬
        "count": res.count, // è§£ææ•°æ®é•¿åº¦
        "data": res.data.result // è§£ææ•°æ®åˆ—è¡¨
        };
    },
    cols: [[
      {type: 'radio', title: 'ğŸ˜Š', fixed: true}, // å•é€‰æ¡†
      {field:'id', title: 'ID', width:80, sort: true, fixed: true},
      {field:'title', title: 'ä¹¦å', width:80},
      {field:'author', title: 'ä½œè€…', width:80, sort: true},
      {field:'publication_year', title: 'å‘å¸ƒå¹´ä»½', width:120},
      {field:'isbn', title: 'ISBN'},
      {fixed: 'right', title:'æ“ä½œ', width: 134, minWidth: 125, toolbar: '#barDemo'}
    ]],
    page: true,
    height: 310
  });

  table.on('toolbar(books_table)', function(obj){
    // var id = obj.config.id;
    // var checkStatus = table.checkStatus(id);
    // var othis = lay(this);
    switch(obj.event){
      case 'createNewBook':
        // var data = checkStatus.data;
        // layer.alert(layui.util.escape(JSON.stringify(data)));
        layer.open({
        title: 'æ–°å»ºä¹¦ç±',
        type: 1,
        area: ['80%','80%'],
        content:       '<form method="post" class="layui-form" id="book"  lay-filter="example" style="margin: 25px;width: 500px"> ' +
                        '<div class="layui-form-item"> ' +
                        '<div class="layui-col-md12">' +
                        '<label class="layui-form-label" >ä¹¦å</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="title" name="title" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ä¹¦å"  class="layui-input"> ' +
                        '</div> </div>' +
                        '<div class="layui-col-md12">' +
                        '<div class="layui-form-item"> ' +
                        '<label class="layui-form-label">ä½œè€…</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="author" name="author" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ä½œè€…" class="layui-input"> ' +
                        '</div> </div> </div> </div> ' +
                        '<div class="layui-form-item"> ' +
                        '<div class="layui-col-md12"> ' +
                        '<label style="float:left;display:block;padding-top: 9px;padding-bottom:9px; padding-right:-25px;width:100px;font-weight:400;line-height:20px;text-align:right">å‘å¸ƒæ—¶é—´</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="publication_year" name="publication_year" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥å‘å¸ƒæ—¶é—´" class="layui-input"> ' +
                        '</div> ' +
                        '</div> ' +
                        '</div> ' +
                        '<div class="layui-form-item"> <div class="layui-col-md12"> ' +
                        '<label class="layui-form-label" >isbn</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="ISBN" name="ISBN" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ISBN"  class="layui-input"> ' +
                        '</div> </div> ' +
                        '<div class="layui-form-item" style="float: left;margin-left: 250px"> ' +
                        '<div class="layui-input-block"> ' +
                        '<button class="layui-btn layui-btn-normal" lay-submit lay-filter="ok">ç¡®å®š</button> ' +
                        '</div> ' +
                        '</div> ' +
                        '</form>' +
                        "<script>" +
                        "form.on('submit(ok)', function(data){" +
                          "var field = data.field; // è·å¾—è¡¨å•å­—æ®µ "+
                          "$.ajax({"+
                                    "url:'/book/create',"+
                                    "data:field,"+
                                    "type:'post',"+
                                    "dataType:'json',"+
                                    "headers : {'Content-Type' : 'application/json;charset=utf-8'}, //æ¥å£jsonæ ¼å¼"+
                                    "success:function(data){"+
                                        "console.log(data);"+
                                    "},"+
                                    "error:function(data){"+
                                      "console.log(data);"+
                                    "}"+
                                "});"+
                                "layer.close(index);"+
                          "// æ‰§è¡Œæœç´¢é‡è½½"+
                          "table.reload('books_table', {"+
                            "page: {"+
                              "curr: 1 // é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹"+
                            "},"+
                            "method: 'post',"+
                            "contentType: 'application/json'"+
                          "});"+
                          "layer.msg('æŸ¥è¯¢æˆåŠŸ');"+
                          
                          "return false; // é˜»æ­¢é»˜è®¤ form è·³è½¬"+
                        "});" 
                        
      });
      break;
    };
  });

  table.on('tool(books_table)', function(obj){ // åŒå‡» toolDouble
    var data = obj.data; // è·å¾—å½“å‰è¡Œæ•°æ®
    // console.log(obj)
    if(obj.event === 'edit'){
      layer.open({
        title: 'ç¼–è¾‘ - id:'+ data.id,
        type: 1,
        area: ['80%','80%'],
        content:       '<form  action="/book/create" method="post" class="layui-form" id="book"  lay-filter="example" style="margin: 25px;width: 500px"> ' +
                        '<div class="layui-form-item"> ' +
                        '<div class="layui-col-md12">' +
                        '<label class="layui-form-label" >ä¹¦å</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="title" name="title" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ä¹¦å"  class="layui-input"> ' +
                        '</div> </div>' +
                        '<div class="layui-col-md12">' +
                        '<div class="layui-form-item"> ' +
                        '<label class="layui-form-label">ä½œè€…</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="author" name="author" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ä½œè€…" class="layui-input"> ' +
                        '</div> </div> </div> </div> ' +
                        '<div class="layui-form-item"> ' +
                        '<div class="layui-col-md12"> ' +
                        '<label style="float:left;display:block;padding-top: 9px;padding-bottom:9px; padding-right:-25px;width:100px;font-weight:400;line-height:20px;text-align:right">å‘å¸ƒæ—¶é—´</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="publication_year" name="publication_year" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥å‘å¸ƒæ—¶é—´" class="layui-input"> ' +
                        '</div> ' +
                        '</div> ' +
                        '</div> ' +
                        '<div class="layui-form-item"> <div class="layui-col-md12"> ' +
                        '<label class="layui-form-label" >isbn</label> ' +
                        '<div class="layui-input-block"> ' +
                        '<input type="text" id="ISBN" name="ISBN" lay-verify="title" autocomplete="off" placeholder="è¯·è¾“å…¥ISBN"  class="layui-input"> ' +
                        '</div> </div> ' +
                        '<div class="layui-form-item" style="float: left;margin-left: 250px"> ' +
                        '<div class="layui-input-block"> ' +
                        '<button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="demo1">ç¡®è®¤</button> ' +
                        '</div> ' +
                        '</div> ' +
                        '</form>'
      });
    } else if(obj.event === 'more'){
      // æ›´å¤š - ä¸‹æ‹‰èœå•
      dropdown.render({
        elem: this, // è§¦å‘äº‹ä»¶çš„ DOM å¯¹è±¡
        show: true, // å¤–éƒ¨äº‹ä»¶è§¦å‘å³æ˜¾ç¤º
        data: [{
          title: 'åˆ é™¤',
          id: 'del'
        }],
        click: function(menudata){
          if(menudata.id === 'del'){
            layer.confirm('çœŸçš„åˆ é™¤è¡Œ [id: '+ data.id +'] ä¹ˆ', function(index){
              obj.del(); // åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„
              layer.close(index);
              // å‘æœåŠ¡ç«¯å‘é€åˆ é™¤æŒ‡ä»¤
              $.ajax({
                  url:"/book/"+data.id,
                  //data:{'xxx':xxx,'xx':xxx},
                  type:"delete",
                  //dataType:"json",
                  //headers : {'Content-Type' : 'application/json;charset=utf-8'}, //æ¥å£jsonæ ¼å¼
                  success:function(data){
                      console.log(data);
                  },
                  error:function(data){
                    console.log(data);
                  }
              });
            });
          } 
        },
        align: 'right', // å³å¯¹é½å¼¹å‡º
        style: 'box-shadow: 1px 1px 10px rgb(0 0 0 / 12%);' // è®¾ç½®é¢å¤–æ ·å¼
      })
    }
  });
  // æ—¥æœŸ
  laydate.render({
    elem: '.demo-table-search-date'
  });
  // æœç´¢æäº¤
  form.on('submit(demo-table-search)', function(data){
    var field = data.field; // è·å¾—è¡¨å•å­—æ®µ
    // æ‰§è¡Œæœç´¢é‡è½½
    table.reload('books_table', {
      page: {
        curr: 1 // é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
      },
      method: 'post',
      contentType: 'application/json',
      where: field // æœç´¢çš„å­—æ®µ
    });
    layer.msg('æŸ¥è¯¢æˆåŠŸ');
    return false; // é˜»æ­¢é»˜è®¤ form è·³è½¬
  });
});
</script>
 
</body>
</html>